appId: com.twelvelabs.strands-agent
productName: Strands Agent
directories:
  buildResources: build
files:
  - '!**/.vscode/*'
  - '!src/*'
  - '!electron.vite.config.{js,ts,mjs,cjs}'
  - '!{.eslintcache,eslint.config.mjs,.prettierignore,.prettierrc.yaml,dev-app-update.yml,CHANGELOG.md,README.md}'
  - '!{.env,.env.*,.npmrc,pnpm-lock.yaml}'
  - '!**/node_modules/aws-crt/**/*'  # Exclude aws-crt (optional AWS SDK dependency, not needed for Electron builds)
asarUnpack:
  - resources/**
  - "**/node_modules/@ffmpeg-installer/**/*"
  - "**/node_modules/@ffmpeg-installer/win32-x64/**/*"
  - "**/node_modules/@ffmpeg-installer/win32-ia32/**/*"
  - "**/node_modules/@ffmpeg-installer/darwin-x64/**/*"
  - "**/node_modules/@ffmpeg-installer/darwin-arm64/**/*"
  - "**/node_modules/@ffmpeg-installer/linux-x64/**/*"
win:
  target:
    - target: nsis
      arch:
        - x64
  # Removed ia32 (32-bit) - most modern Windows systems are 64-bit
  # Building only x64 reduces build time and avoids app-builder.exe errors
  icon: build/icon.ico  # Keep using .ico format for Windows (you can replace this file with TwelveLabs logo converted to .ico)
  publisherName: TwelveLabs
  # Completely disable code signing to prevent winCodeSign download
  sign: null
  verifyUpdateCodeSignature: false
  signingHashAlgorithms: []  # Empty array prevents signing tool download
nsis:
  artifactName: ${productName}-${version}-setup.${ext}
  shortcutName: ${productName}
  uninstallDisplayName: ${productName}
  createDesktopShortcut: always
  oneClick: false
  allowToChangeInstallationDirectory: true
mac:
  category: public.app-category.productivity
  target:
    - target: dmg
      arch:
        - universal  # Universal binary for both Intel and Apple Silicon Macs
  icon: build/icon.icns
  hardenedRuntime: false  # Disabled - requires code signing
  gatekeeperAssess: false
  minimumSystemVersion: "12.0"  # macOS Monterey 12.0+ (Electron 33 requirement)
  extendInfo:
    LSMinimumSystemVersion: "12.0"
    NSCameraUsageDescription: Application requests access to the device's camera.
    NSMicrophoneUsageDescription: Application requests access to the device's microphone.
    NSDocumentsFolderUsageDescription: Application requests access to the user's Documents folder.
    NSDownloadsFolderUsageDescription: Application requests access to the user's Downloads folder.
dmg:
  artifactName: ${productName}-${version}.${ext}
  # Removed 'title' property - it triggers DMG customization requiring Perl module
  # Removed 'icon' property - it also triggers customization
  # This minimal config avoids Mac::Finder::DSStore Perl module dependency
  # DMG will be created with default macOS layout (functional but basic)
linux:
  target:
    - AppImage
    - snap
    - deb
  maintainer: electronjs.org
  category: Utility
appImage:
  artifactName: ${name}-${version}.${ext}
npmRebuild: false  # Disable native module rebuilding (aws-crt is optional and not needed)

# Environment variables for production builds
# Set these before building:
# - APPLE_ID, APPLE_APP_SPECIFIC_PASSWORD, APPLE_TEAM_ID (for macOS notarization)
# - CERTIFICATE_FILE, CERTIFICATE_PASSWORD (for Windows code signing)

publish:
  provider: generic
  url: https://example.com/auto-updates
  # For auto-updates, configure your update server URL above

electronDownload:
  mirror: https://npmmirror.com/mirrors/electron/

# Completely disable code signing to avoid Windows symlink permission issues
# The error occurs because winCodeSign extraction requires admin privileges for symlinks
# Setting CSC_LINK to empty string prevents electron-builder from downloading signing tools
forceCodeSigning: false

# Compression and optimization
compression: maximum